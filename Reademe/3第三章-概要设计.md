# 第三章 概要设计

​	本章主要介绍自助洗衣系统的概要设计，首先介绍自助洗衣系统的总体架构，由于系统采用微服务架构，系统被拆分为各个服务，用功能模块图描述服务与服务之间的关系，最后对系统数据库进行概要设计，使用E-R图描述实体及其之间的关系。

## 3.1 总体设计

​	系统整体采用B/S的模式进行开发，这样做的好处是用户不需要下载客户端便可以使用服务。系统核心架构使用了微服务架构进行开发，将所有服务进行拆分，服务内部高度内聚，每个服务只负责处理与自己相关的业务信息。同时服务也可以进行横向扩展与集群，大大提高了系统的灵活性。

​	系统采用微服务架构，后台开发语言采用Java语言开发，服务与运行在Tomcat服务器上，数据库使用MySQL，缓存中间件使用Redis。

​	前端化工程使用Vue开发，使用WebPackage打包后也运行在Tomcat服务器上，快跨域接口调用使用Nginx作服务器反向代理。

​	系统总体架构如图3-1所示。

​                      -----------------------------------------------------------

## 3.2 模块设计

​	按照微服务所提供的业务服务不同，将系统分为注册中心、路由网关、授权认证中心、用户处理服务、设备处理服务、订单管理服务6个服务。系统功能模块图如图3-2所示。

​                      -----------------------------------------------------------

### 3.2.1 注册中心

​	注册中心包括服务注册与服务发现两大核心功能，注册中心子功能模块图如图3-3所示。

​                      -----------------------------------------------------------

#### 3.2.1.1 服务注册

​		所有的微服务都以一个单独的Spring Boot项目部署在服务其上，注册中心的服务注册就是将各种外部服务注册在这个服务上，这样，服务与服务之间就可以产生联系，调用相互的接口，实现块服务的调用。

#### 3.2.1.2 服务发现

​		服务发现就是当项目在运行过程中，可以主动的发现注册在注册中心的各个服务，并获取服务的统一资源定位符以及端口，在系统运行时，当一个服务需要另一个服务的数据时，就可以根据这些信息取请求接口，获取数据。

### 3.2.2 路由网关

​	路由网关的作用就像他的名字一样，是为了保护系统受到非法请求攻击，同时分发不同的外部的合法请求的网关，路由网关主要有路由拦截与权限判断两大核心功能，路由网关子功能模块图如图3-4所示。

​                      -----------------------------------------------------------

#### 3.2.2.1 路由拦截

​		由于系统需要接收外部请求，和互联网的不安全性，路由拦截可以很好的过滤调一些攻击性请求，从而保护内部系统。

#### 3.2.2.2 权限判断

​		合法的请求中会带有授权认证中心颁发的令牌，路由权限判断会判断当前请求是否能合法的调用服务。

### 3.2.3 授权认证中心

​	授权认证中心负责验证用户是否合法、客户端是否是系统指定的客户端，系统允许未经允许的第三方客户端访问系统。授权认证中心子功能模块图如图3-5所示。

​                      -----------------------------------------------------------

#### 3.2.3.1 用户权限认证

​		根据用户的用户名密码，校验用户是否是合法用户，合法用户会被系统分配一个有限时间的令牌，令牌中存储了用户的信息，这些信息就是用户能访问系统的依据。

#### 3.2.3.2 客户端权限认证

​		校验发出请求的客户端是否合法，合法客户端拥有一个密钥，与系统密钥相对应，这个密钥是保密的。

#### 3.2.3.3 令牌分发

​		所有校验都通过后，系统会生成一个乱序字符串，生成字符串的相关信息会被存在系统的缓存中，接下来这个乱序字符串就会被系统分发给用户，存储到用户的客户端缓存中。

### 3.2.4 用户处理服务

​	用户处理服务负责一切与用户有关的业务，如用户昵称创建，密码修改，头像上传，支付密码校验等。用户处理服务子功能模块图如图3-6所示。

​                      -----------------------------------------------------------

#### 3.2.4.1 用户资料更新

​		用户的昵称、密码、支付密码、个人信息的更新以及系统所有与用户相关的业务逻辑与功能都要由这个子模块处理。

#### 3.2.4.2 用户支付密码校验

​		在用户支付时。用户需要提供一个6位的密码来保护财产安全，这个模块被用来校验密码。

### 3.2.5 设备处理服务

​	设备处理服务负责一切与设备有关的业务，如设备的新增，修改设备信息，使用设备信息。设备处理服务子功能模块图如图3-7所示。

​                      -----------------------------------------------------------

#### 3.2.5.1 设备信息获取

​		在系统中，用户与管理员都需要获取设备信息，设备信息的统一来源就来源于这个服务。

#### 3.2.5.2设备信息更新

​		设备信息在用户创建订单以及管理员更新时需要用到更新设备信息，这部分业务逻辑需要这个模块来完成。

### 3.2.6 订单管理服务

​	订单管理服务负责一切与订单有关的业务，如订单创建，订单状态更新，导出订单等。订单管理服务子功能模块图如图3-8所示。

​                      -----------------------------------------------------------

#### 3.2.6.1 创建订单

​		用户在使用系统中的设备时会创建订单，相关业务由本子模块处理。

#### 3.2.6.2 订单状态更新

​		在设备完成订单后，设备会通知系统完成订单，此时订单会更新位完成状态。

## 3.3 数据库概要设计

​	通过分析用户与系统内各个实体之间的相互关系，绘制E-R图，实现数据库的概要设计。

​	经分析，自助洗衣系统的实体包含服务、设备、状态、用户与订单5个实体，以设备为中心，设备与服务之间的关系是一对多，设备与状态的对应关系是一对一设备与订单的关系是多对多，设备与用户之间的关系是多对一，进而得出实体关系图，实体关系图如图3-9所示。

​                      -----------------------------------------------------------

​	设备实体包含设备ID，型号，品牌，服务类别，入库日期，更新日期，伪删除标记位，乐观锁，经度，纬度属性组成。设备实体属性图如图3-10所示。

​                      -----------------------------------------------------------

​	用户实体包含用户ID，用户名，昵称，密码，创建时间，更新时间，伪删除标志位，乐观锁，支付密码。用户实体属性图如图3-11所示。

​                      -----------------------------------------------------------

​	订单实体包含订单ID，顾客ID，设备ID，服务等级，开始时间，创建时间，更新时间，伪删除标志位，乐观锁，订单状态。订单实体属性图如图3-12所示。

​                      -----------------------------------------------------------

​	服务实体包含服务ID，服务类型，服务级别，服务等级，服务金额，创建时间，更新时间，伪删除标志位，乐观锁。服务实体属性图如图3-13所示。

​                      -----------------------------------------------------------

​	状态实体包含服务唯一标识，设备唯一标识，状态，可提供服务，创建时间，更新时间，伪删除标志位，乐观锁。状态实体属性图如图3-14所示。

​                      -----------------------------------------------------------

## 3.4 本章小结

​	本章通过文字与E-R图以及架构图进行了自助洗衣系统系统各个功能模块与数据库的概要设计。服务与服务，服务与用户，数据库，系统架构与组成结构之间的联系有了设计，对系统内的实体也进行了初步分析。